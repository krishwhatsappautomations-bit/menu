<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Krish Fast Food ‚Äì Order Menu</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f6f6f6;
        margin: 0;
        padding: 0;
    }
    .container {
        max-width: 500px;
        margin: auto;
        padding: 15px;
    }
    .item {
        background: white;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 10px;
        box-shadow: 0px 1px 4px rgba(0,0,0,0.1);
    }
    .item h3 {
        margin: 0;
    }
    .qty-box {
        width: 50px;
        padding: 5px;
        font-size: 16px;
    }
    #orderBtn {
        background: #25D366;
        padding: 15px;
        color: white;
        font-size: 18px;
        border: none;
        width: 100%;
        border-radius: 8px;
        margin-top: 20px;
        cursor: pointer;
    }
    #orderBtn:disabled {
        background: #9dd9b8;
    }
    .bill-img {
        width: 100%;
        border-radius: 10px;
        margin-top: 10px;
        display: none;
    }
</style>
</head>

<body>

<div class="container">

<h2>üçΩ Krish Fast Food ‚Äì Quick Menu</h2>

<div id="menuList"></div>

<input id="custName" class="txt" placeholder="Your Name" style="width:100%;padding:10px;margin-top:15px;border-radius:8px;">
<input id="custTable" class="txt" placeholder="Table / Delivery" style="width:100%;padding:10px;margin-top:10px;border-radius:8px;">

<img id="billPreview" class="bill-img" />

<button id="orderBtn" onclick="finalOrder()">Order on WhatsApp</button>

</div>

<script>
/* ------------------------ CONFIG ------------------------ */
const shopName = "Krish Fast Food";
const phoneNumber = "9373606511";
const imgbbKey = "956539c8c9e7053902668964f579be06";

/* ------------------------ MENU ITEMS ------------------------ */
const items = [
    { id: 1, name: "Margherita Pizza", price: 129 },
    { id: 2, name: "Paneer Tikka Pizza", price: 229 },
    { id: 3, name: "Veg Burger", price: 69 },
    { id: 4, name: "Cold Coffee", price: 79 }
];

let selected = {};

/* ------------------------ RENDER MENU ------------------------ */
function renderMenu() {
    let box = document.getElementById("menuList");
    items.forEach(it => {
        box.innerHTML += `
            <div class="item">
                <h3>${it.name} ‚Äì ‚Çπ${it.price}</h3>
                <label>
                    <input type="checkbox" onchange="toggleItem(${it.id})"> Add
                </label>
                <input id="qty${it.id}" class="qty-box" type="number" value="1" min="1">
            </div>
        `;
    });
}
renderMenu();

/* ------------------------ SELECT / UNSELECT ITEM ------------------------ */
function toggleItem(id) {
    let cb = event.target;
    if (cb.checked) selected[id] = true;
    else delete selected[id];
}

/* ------------------------ GENERATE BILL IMAGE ------------------------ */
function generateBill() {
    return new Promise(resolve => {
        let total = 0;
        let text = `${shopName}\n\n`;

        for (let id in selected) {
            let it = items.find(x => x.id == id);
            let qty = parseInt(document.getElementById("qty" + id).value);
            let line = qty * it.price;
            total += line;
            text += `${it.name}  x${qty}  = ‚Çπ${line}\n`;
        }

        text += `\n--------------------\nTotal: ‚Çπ${total}`;

        // Create canvas
        let canvas = document.createElement("canvas");
        canvas.width = 800;
        canvas.height = 600;
        let ctx = canvas.getContext("2d");
        ctx.fillStyle = "#ffffff";
        ctx.fillRect(0, 0, 800, 600);
        ctx.fillStyle = "#000000";
        ctx.font = "28px Arial";
        text.split("\n").forEach((t, i) => {
            ctx.fillText(t, 20, 40 + i * 35);
        });

        resolve(canvas.toDataURL("image/png"));
    });
}

/* ------------------------ UPLOAD TO IMGBB ------------------------ */
async function uploadToImgBB(base64) {
    let form = new FormData();
    form.append("image", base64.split(",")[1]);

    let res = await fetch("https://api.imgbb.com/1/upload?key=" + imgbbKey, {
        method: "POST",
        body: form
    });

    let json = await res.json();
    return json.data.url;
}

/* ------------------------ FINAL ORDER ------------------------ */
async function finalOrder() {
    if (Object.keys(selected).length === 0)
        return alert("Please select at least 1 item.");

    let name = document.getElementById("custName").value.trim();
    let table = document.getElementById("custTable").value.trim();

    if (!name || !table)
        return alert("Enter Name & Table / Address.");

    let billImgBase64 = await generateBill();
    document.getElementById("billPreview").src = billImgBase64;
    document.getElementById("billPreview").style.display = "block";

    let imgURL = await uploadToImgBB(billImgBase64);

    let orderId = Math.floor(100000 + Math.random() * 900000);

    let orderedLines = "";
    let total = 0;

    for (let id in selected) {
        let it = items.find(x => x.id == id);
        let qty = parseInt(document.getElementById("qty" + id).value);
        let line = qty * it.price;
        total += line;
        orderedLines += `${it.name} x${qty} - ‚Çπ${line}\n`;
    }

    let finalText =
`*${shopName}*
Order ID: #${orderId}

${orderedLines}
*Total: ‚Çπ${total}*

Customer: ${name}
Table/Delivery: ${table}

Bill Image:
${imgURL}
`;

    let encoded = encodeURIComponent(finalText);
    window.open(`https://wa.me/${phoneNumber}?text=${encoded}`, "_blank");
}
</script>

</body>
</html>

